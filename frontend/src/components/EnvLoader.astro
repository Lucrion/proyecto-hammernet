---
// Componente para generar dinámicamente el script env-loader
// Lee las variables de entorno reales y las inyecta en el navegador

// Obtener variables de entorno
const PUBLIC_API_URL = import.meta.env.PUBLIC_API_URL;
const PUBLIC_API_URL_PRODUCTION = import.meta.env.PUBLIC_API_URL_PRODUCTION;
const PUBLIC_CORS_CREDENTIALS = import.meta.env.PUBLIC_CORS_CREDENTIALS;
const PUBLIC_CORS_MODE = import.meta.env.PUBLIC_CORS_MODE;
const PUBLIC_API_TIMEOUT = import.meta.env.PUBLIC_API_TIMEOUT;
const PUBLIC_ENVIRONMENT = import.meta.env.PUBLIC_ENVIRONMENT;
const PUBLIC_ANALYTICS_ENABLED = import.meta.env.PUBLIC_ANALYTICS_ENABLED;
const FRONTEND_URL = import.meta.env.FRONTEND_URL;
const GOOGLE_MAPS_API_KEY = import.meta.env.GOOGLE_MAPS_API_KEY;

// Detectar si estamos en desarrollo
const isDevelopment = PUBLIC_ENVIRONMENT === 'development';
---

<script is:inline define:vars={{ 
  PUBLIC_API_URL, 
  PUBLIC_API_URL_PRODUCTION, 
  PUBLIC_CORS_CREDENTIALS, 
  PUBLIC_CORS_MODE, 
  PUBLIC_API_TIMEOUT, 
  PUBLIC_ENVIRONMENT,
  PUBLIC_ANALYTICS_ENABLED,
  FRONTEND_URL,
  GOOGLE_MAPS_API_KEY,
  isDevelopment 
}}>
  // Script para cargar variables de entorno en el navegador
  // Este script se genera dinámicamente desde las variables del .env
  
  (function() {
    'use strict';
    
    // Detectar si estamos en desarrollo o producción
    const isDevEnvironment = typeof window !== 'undefined' 
      ? (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
      : false;
    
    // Configuración de variables de entorno (generadas automáticamente desde .env)
    const envConfig = {
      // URLs de API
      PUBLIC_API_URL: isDevEnvironment ? PUBLIC_API_URL : PUBLIC_API_URL_PRODUCTION,
      PUBLIC_API_URL_PRODUCTION: PUBLIC_API_URL_PRODUCTION,
      
      // Configuración de CORS
      PUBLIC_CORS_CREDENTIALS: PUBLIC_CORS_CREDENTIALS,
      PUBLIC_CORS_MODE: PUBLIC_CORS_MODE,
      
      // Timeout de API
      PUBLIC_API_TIMEOUT: PUBLIC_API_TIMEOUT,
      
      // Entorno
      PUBLIC_ENVIRONMENT: isDevEnvironment ? 'development' : 'production',
      PUBLIC_ANALYTICS_ENABLED: PUBLIC_ANALYTICS_ENABLED,
      FRONTEND_URL: FRONTEND_URL,
      GOOGLE_MAPS_API_KEY: GOOGLE_MAPS_API_KEY
    };
    
    // Hacer las variables disponibles globalmente
    if (typeof window !== 'undefined') {
      window.__ENV__ = envConfig;
      try { window.GOOGLE_MAPS_API_KEY = GOOGLE_MAPS_API_KEY; } catch {}
      try { window.API_BASE = envConfig.PUBLIC_API_URL || envConfig.PUBLIC_API_URL_PRODUCTION || '/api'; } catch {}
      try { console.log('Cargando script de login...'); console.log('API URL es:', window.API_BASE); } catch {}
      
      // También crear una función helper para acceder a las variables
      window.getEnvVar = function(name, defaultValue = undefined) {
        return window.__ENV__[name] || defaultValue;
      };
      
      // Log para debugging (solo en desarrollo)
      if (isDevEnvironment) {
        console.log('Variables de entorno cargadas desde .env:', window.__ENV__);
      }
    }
  })();
</script>
